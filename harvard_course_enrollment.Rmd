---
title: "Harvard Course Enrollment"
author: "Dasha Metropolitansky"
date: "April 9, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)
library(janitor)
library(fs)

download.file(url = "https://registrar.fas.harvard.edu/files/fas-registrar/files/class_enrollment_summary_by_term_3.22.19.xlsx",
              destfile = "reg_2019.xlsx",
              mode = "wb")

download.file(url = "https://registrar.fas.harvard.edu/files/fas-registrar/files/class_enrollment_summary_by_term_03.06.18.xlsx",
              destfile = "reg_2018.xlsx",
              mode = "wb")

spring_2019 = read_excel("reg_2019.xlsx", skip = 3) %>% 
  clean_names() %>%
  filter(!is.na(course_name)) %>%
  select(course_id, u_grad, course_department)
  
spring_2018 = read_excel("reg_2018.xlsx", skip = 3) %>% 
  clean_names() %>%
  filter(!is.na(course_name)) %>%
  select(course_id, u_grad, course_department)

file_delete(c("reg_2018.xlsx", "reg_2019.xlsx")) 
```

```{r}
spring_2019 %>%
  left_join(spring_2018, by = "course_id") %>%
  filter(course_department.x == course_department.y) %>%
  select(-course_department.y) %>%
  rename(course_department = course_department.x,
         u_grad_2019 = u_grad.x, 
         u_grad_2018 = u_grad.y) %>%
  mutate(course_department = recode_factor(course_department,
                                           `African & African Amer Studies` = "African Studies",
                                           `Classics, The` = "Classics",
                                           `Celtic Languages & Literatures` = "Celtic Languages",
                                           `East Asian Langs & Civ` = "East Asian Languages",
                                           `Envi Science & Public Policy` = "Environmental Science",
                                           `Germanic Languages & Lit` = "Germanic Languages",
                                           `Near Eastern Languages & Civ` = "Near Eastern Languages",
                                           `Organismic & Evolutionary Biol` = "Organismic & Evolutionary Biology",
                                           `Religion, The Study of` = "Religion",
                                           `Romance Languages & Lit` = "Romance Languages",
                                           `Slavic Languages & Literatures` = "Slavic Languages",
                                           `Stem Cell & Regenerative Biol` = "Stem Cell & Regenerative Biology")) %>%
  group_by(course_department) %>%
  summarise(department_total_19 = sum(u_grad_2019),
            department_total_18 = sum(u_grad_2018)) %>%
  filter(!(department_total_19 == 0 | department_total_18 == 0)) %>%
  mutate(percent_change = round(((department_total_19 - department_total_18)/department_total_18 * 100), digits = 0))
  
```

